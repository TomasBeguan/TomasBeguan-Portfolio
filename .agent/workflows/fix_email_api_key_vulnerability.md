---
description: Fix Email Sender API Key Vulnerability
---

## Objective
Securely handle the Resend email API key to prevent it from being exposed in the codebase or client-side bundles.

## Steps
1. **Create Environment File**
   - In the project root, create a file named `.env.local` (or `.env` for production).
   - Add the following line (replace with your actual key):
     ```
     RESEND_API_KEY=your_resend_api_key_here
     ```
   - **Do NOT commit** this file. It should be listed in `.gitignore`.

2. **Update `.gitignore`**
   - Ensure the following lines exist in the project's `.gitignore` file:
     ```
     # Environment variables
     .env*
     ```
   - If the file does not exist, create it at the project root.

3. **Load Environment Variables**
   - Next.js automatically loads variables from `.env*` files prefixed with `NEXT_PUBLIC_` for client exposure. Since `RESEND_API_KEY` is **server‑only**, no prefix is needed.
   - Verify that `process.env.RESEND_API_KEY` is accessible in server‑side code (e.g., API routes).

4. **Remove Hard‑Coded Keys**
   - Search the codebase for any occurrence of the literal key (`re_D1FmonTA_3hb4of7fGC61afb2pDG8GKHB`).
   - Replace any hard‑coded instances with `process.env.RESEND_API_KEY`.
   - Ensure the key is never imported or sent to the client bundle.

5. **Add Example File**
   - Create `.env.example` at the project root with a placeholder:
     ```
     RESEND_API_KEY=your_resend_api_key_here
     ```
   - This helps other developers know which env vars are required.

6. **Verify Server‑Only Usage**
   - Open `src/app/api/contact/route.ts` and confirm it uses the lazy `getResend()` helper which reads from `process.env.RESEND_API_KEY`.
   - Ensure no import of the key exists in any client‑side component (`.tsx` under `src/app` that is not an API route).

7. **Test the Endpoint**
   - Run the development server: `npm run dev`.
   - Submit the contact form and verify that the email is sent without errors.
   - Check the server console for any warnings about missing `RESEND_API_KEY`.

8. **Deploy Securely**
   - In your deployment platform (Vercel, Netlify, etc.), add the `RESEND_API_KEY` as a secret environment variable.
   - Do **not** push the `.env.local` file to the repository.

9. **Optional: Add Rate Limiting & Honeypot**
   - The existing `route.ts` already includes a simple in‑memory rate limiter and a honeypot field. Review and adjust limits as needed.

## Outcome
- The API key is stored securely in environment variables.
- No secret is present in the source code or client bundles.
- The project is ready for safe deployment.
